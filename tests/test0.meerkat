service foo_service {
    var one = 1;
    var x = 1;
    var y = 2;
    def f = x + y;
    def g = x * y;
    def h = g - f;

    pub def inc_x = action { x = x + 1; };
    pub def inc_y = action { y = y + 1; };
    pub def inc_x_y = action { x = x + 1; y = y + 1; };

    pub def inc_x_by = fn z => action { x = x + z; };
    // pub def inc_x_by = fn x => action { x = x + z; }; // should not pass!
    // pub def inc_x_by = fn z => action { x = x + w; }; // should not pass!

    pub def inc_x_ = inc_x_by(one);

}

@test(foo_service) {
    
    do inc_x_;  // txn 1
    assert(g == 4);
    assert(f == 4);

    do inc_x_;  // txn 2
    // assert(f == 4);
    /* 
    if we move assert f == 4 here 
    there's a chance of passed test
    */
    /* 
    will fix this by adding txn2 as pred 
    of def actor of assert(f == 4)
    */
    assert(x == 3 && y == 2);
    assert(g == 6);
    assert(f == 5);
    assert(h == 1);

    do inc_y;
    assert(x == 3 && y == 3);
    assert(g == 9);
    assert(f == 6);
    assert(h == 3);

    do inc_x_y;
    assert(x == 4 && y == 4);

}